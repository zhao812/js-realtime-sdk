!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],b):b(a.AV=a.AV||{},a.AV)}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a.default:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),g=d(function(a){var b=a.exports={version:"2.4.0"};"number"==typeof __e&&(__e=b)}),h=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},i=function(a,b,c){if(h(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},j=function(a){return"object"==typeof a?null!==a:"function"==typeof a},k=function(a){if(!j(a))throw TypeError(a+" is not an object!");return a},l=function(a){try{return!!a()}catch(a){return!0}},m=!l(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),n=f.document,o=j(n)&&j(n.createElement),p=function(a){return o?n.createElement(a):{}},q=!m&&!l(function(){return 7!=Object.defineProperty(p("div"),"a",{get:function(){return 7}}).a}),r=function(a,b){if(!j(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!j(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!j(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!j(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},s=Object.defineProperty,t=m?Object.defineProperty:function(a,b,c){if(k(a),b=r(b,!0),k(c),q)try{return s(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},u={f:t},v=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},w=m?function(a,b,c){return u.f(a,b,v(1,c))}:function(a,b,c){return a[b]=c,a},x=function(a,b,c){var d,e,h,j=a&x.F,k=a&x.G,l=a&x.S,m=a&x.P,n=a&x.B,o=a&x.W,p=k?g:g[b]||(g[b]={}),q=p.prototype,r=k?f:l?f[b]:(f[b]||{}).prototype;k&&(c=b);for(d in c)(e=!j&&r&&void 0!==r[d])&&d in p||(h=e?r[d]:c[d],p[d]=k&&"function"!=typeof r[d]?c[d]:n&&e?i(h,f):o&&r[d]==h?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(h):m&&"function"==typeof h?i(Function.call,h):h,m&&((p.virtual||(p.virtual={}))[d]=h,a&x.R&&q&&!q[d]&&w(q,d,h)))};x.F=1,x.G=2,x.S=4,x.P=8,x.B=16,x.W=32,x.U=64,x.R=128;var y=x;y(y.S+y.F*!m,"Object",{defineProperty:u.f});var z=g.Object,A=function(a,b,c){return z.defineProperty(a,b,c)},B=d(function(a){a.exports={default:A,__esModule:!0}}),C=d(function(a,b){b.__esModule=!0;var c=function(a){return a&&a.__esModule?a:{default:a}}(B);b.default=function(a,b,d){return b in a?(0,c.default)(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d,a}}),D=c(C),E={}.hasOwnProperty,F=function(a,b){return E.call(a,b)},G={}.toString,H=function(a){return G.call(a).slice(8,-1)},I=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==H(a)?a.split(""):Object(a)},J=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a},K=function(a){return I(J(a))},L=Math.ceil,M=Math.floor,N=function(a){return isNaN(a=+a)?0:(a>0?M:L)(a)},O=Math.min,P=function(a){return a>0?O(N(a),9007199254740991):0},Q=Math.max,R=Math.min,S=function(a,b){return a=N(a),a<0?Q(a+b,0):R(a,b)},T=f["__core-js_shared__"]||(f["__core-js_shared__"]={}),U=0,V=Math.random(),W=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++U+V).toString(36))},X=function(a){return T[a]||(T[a]={})}("keys"),Y=function(a){return function(b,c,d){var e,f=K(b),g=P(f.length),h=S(d,g);if(a&&c!=c){for(;g>h;)if((e=f[h++])!=e)return!0}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}}(!1),Z=function(a){return X[a]||(X[a]=W(a))}("IE_PROTO"),$=function(a,b){var c,d=K(a),e=0,f=[];for(c in d)c!=Z&&F(d,c)&&f.push(c);for(;b.length>e;)F(d,c=b[e++])&&(~Y(f,c)||f.push(c));return f},_="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),aa=Object.keys||function(a){return $(a,_)},ba=Object.getOwnPropertySymbols,ca={f:ba},da={}.propertyIsEnumerable,ea={f:da},fa=function(a){return Object(J(a))},ga=Object.assign,ha=!ga||l(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=ga({},a)[c]||Object.keys(ga({},b)).join("")!=d})?function(a,b){for(var c=fa(a),d=arguments.length,e=1,f=ca.f,g=ea.f;d>e;)for(var h,i=I(arguments[e++]),j=f?aa(i).concat(f(i)):aa(i),k=j.length,l=0;k>l;)g.call(i,h=j[l++])&&(c[h]=i[h]);return c}:ga;y(y.S+y.F,"Object",{assign:ha});var ia=g.Object.assign,ja=d(function(a){a.exports={default:ia,__esModule:!0}}),ka=c(ja),la=d(function(a,b){!function(b){function c(a){var b=k(a);if(q)for(var c,d=0;c=t[d++];)a.hasOwnProperty(c)&&b.push(c);return b}function d(a,b,d){for(var e,f,h=c(d),i=0,j=h.length;i<j;)"__self"!==(e=h[i++])&&(f=d[e],!o(f)||f.prototype&&f.prototype.__self||g&&!(f.toString().indexOf(".__base")>-1)?b[e]=f:b[e]=function(c,d){var e=a[c]?a[c]:"__constructor"===c?b.__self.__parent:p,f=function(){var a=this.__base;this.__base=f.__base;var b=d.apply(this,arguments);return this.__base=a,b};return f.__base=e,f}(e,f))}function e(a,b){for(var c,d=1;c=a[d++];)b?o(c)?f.self(b,c.prototype,c):f.self(b,c):b=o(c)?f(a[0],c.prototype,c):f(a[0],c);return b||a[0]}function f(){var a=arguments,b=n(a[0]),c=b||o(a[0]),f=c?b?e(a[0]):a[0]:h,g=a[c?1:0]||{},i=a[c?2:1],k=g.__constructor||c&&f.prototype&&f.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:c?function(){return f.apply(this,arguments)}:function(){};if(!c)return k.prototype=g,k.prototype.__self=k.prototype.constructor=k,l(k,i);l(k,f),k.__parent=f;var m=f.prototype,p=k.prototype=j(m);return p.__self=p.constructor=k,g&&d(m,p,g),i&&d(f,k,i),k}var g=function(){return"_"}.toString().indexOf("_")>-1,h=function(){},i=Object.prototype.hasOwnProperty,j=Object.create||function(a){var b=function(){};return b.prototype=a,new b},k=Object.keys||function(a){var b=[];for(var c in a)i.call(a,c)&&b.push(c);return b},l=function(a,b){for(var c in b)i.call(b,c)&&(a[c]=b[c]);return a},m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=function(a){return"[object Function]"===m.call(a)},p=function(){},q=!0,r={toString:""};for(var s in r)r.hasOwnProperty(s)&&(q=!1);var t=q?["toString","valueOf"]:null;f.self=function(){var a=arguments,b=n(a[0]),c=b?e(a[0],a[0][0]):a[0],f=a[1],g=a[2],h=c.prototype;return f&&d(h,h,f),g&&d(c,c,g),c};var u=!0;a.exports=f,u=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(a){a(f)}),u=!1),u&&(b.inherit=f)}(e)}),ma=la;if(!b.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var na=ma(b.TypedMessage,{__constructor:function(a){this.__base(),this.timestamp=new Date(a)}});b.messageType(-101)(na),b.messageField(["timestamp"])(na),na.sendOptions={transient:!0};var oa={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[na],onIMClientCreate:function(a){var b=a._sendReadCommand;a._sendReadCommand=function(c){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c.forEach(function(a){!a.transient&&a.members.length>2&&a.send(new na(a.lastMessageAt||new Date)).catch(function(a){return console.warn("Sending groupchat receipt fail: "+a.message)})}),b.call.apply(b,[a,c].concat(e))}},onConversationCreate:function(a){var b=a.queryMessages;a.queryMessages=function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return!a.transient&&a.members.length>2&&!a.lastReadTimestamps&&a._fetchAllReceiptTimestamps().then(function(b){a.lastReadTimestamps=b.reduce(function(a,b){var c=b.pid,d=b.lastReadAt;return ka(a,D({},c,d))},{}),a.emit("lastreadtimestampsupdate",a.lastReadTimestamps)}).catch(function(a){return console.warn("Initialize group receipts fail: "+a.message)}),b.call.apply(b,[a].concat(d))}},beforeMessageDispatch:function(a,b){return a.type!==na.TYPE||(b.lastReadTimestamps&&(b.lastReadTimestamps[a.from]=a.timestamp,b.emit("lastreadtimestampsupdate",D({},a.from,a.timestamp))),!1)}};a.GroupchatReceiptsPlugin=oa,a.ReadReceipt=na,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=groupchat-receipts.min.js.map