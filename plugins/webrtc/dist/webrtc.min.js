!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],b):b(a.AV=a.AV||{},a.AV)}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a.default:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=function(a,b){return{value:b,done:!!a}},g={},h={}.toString,i=function(a){return h.call(a).slice(8,-1)},j=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==i(a)?a.split(""):Object(a)},k=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a},l=function(a){return j(k(a))},m=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),n=d(function(a){var b=a.exports={version:"2.4.0"};"number"==typeof __e&&(__e=b)}),o=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},p=function(a,b,c){if(o(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},q=function(a){return"object"==typeof a?null!==a:"function"==typeof a},r=function(a){if(!q(a))throw TypeError(a+" is not an object!");return a},s=function(a){try{return!!a()}catch(a){return!0}},t=!s(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),u=m.document,v=q(u)&&q(u.createElement),w=function(a){return v?u.createElement(a):{}},x=!t&&!s(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),y=function(a,b){if(!q(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!q(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!q(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!q(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},z=Object.defineProperty,A=t?Object.defineProperty:function(a,b,c){if(r(a),b=y(b,!0),r(c),x)try{return z(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},B={f:A},C=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},D=t?function(a,b,c){return B.f(a,b,C(1,c))}:function(a,b,c){return a[b]=c,a},E=function(a,b,c){var d,e,f,g=a&E.F,h=a&E.G,i=a&E.S,j=a&E.P,k=a&E.B,l=a&E.W,o=h?n:n[b]||(n[b]={}),q=o.prototype,r=h?m:i?m[b]:(m[b]||{}).prototype;h&&(c=b);for(d in c)(e=!g&&r&&void 0!==r[d])&&d in o||(f=e?r[d]:c[d],o[d]=h&&"function"!=typeof r[d]?c[d]:k&&e?p(f,m):l&&r[d]==f?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(f):j&&"function"==typeof f?p(Function.call,f):f,j&&((o.virtual||(o.virtual={}))[d]=f,a&E.R&&q&&!q[d]&&D(q,d,f)))};E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128;var F=E,G=D,H={}.hasOwnProperty,I=function(a,b){return H.call(a,b)},J=Math.ceil,K=Math.floor,L=function(a){return isNaN(a=+a)?0:(a>0?K:J)(a)},M=Math.min,N=function(a){return a>0?M(L(a),9007199254740991):0},O=Math.max,P=Math.min,Q=function(a,b){return a=L(a),a<0?O(a+b,0):P(a,b)},R=m["__core-js_shared__"]||(m["__core-js_shared__"]={}),S=function(a){return R[a]||(R[a]={})},T=0,U=Math.random(),V=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++T+U).toString(36))},W=S("keys"),X=function(a){return W[a]||(W[a]=V(a))},Y=function(a){return function(b,c,d){var e,f=l(b),g=N(f.length),h=Q(d,g);if(a&&c!=c){for(;g>h;)if((e=f[h++])!=e)return!0}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}}(!1),Z=X("IE_PROTO"),$=function(a,b){var c,d=l(a),e=0,f=[];for(c in d)c!=Z&&I(d,c)&&f.push(c);for(;b.length>e;)I(d,c=b[e++])&&(~Y(f,c)||f.push(c));return f},_="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),aa=Object.keys||function(a){return $(a,_)},ba=t?Object.defineProperties:function(a,b){r(a);for(var c,d=aa(b),e=d.length,f=0;e>f;)B.f(a,c=d[f++],b[c]);return a},ca=m.document&&document.documentElement,da=X("IE_PROTO"),ea=function(){},fa=function(){var a,b=w("iframe"),c=_.length;for(b.style.display="none",ca.appendChild(b),b.src="javascript:",a=b.contentWindow.document,a.open(),a.write("<script>document.F=Object<\/script>"),a.close(),fa=a.F;c--;)delete fa.prototype[_[c]];return fa()},ga=Object.create||function(a,b){var c;return null!==a?(ea.prototype=r(a),c=new ea,ea.prototype=null,c[da]=a):c=fa(),void 0===b?c:ba(c,b)},ha=d(function(a){var b=S("wks"),c=m.Symbol,d="function"==typeof c;(a.exports=function(a){return b[a]||(b[a]=d&&c[a]||(d?c:V)("Symbol."+a))}).store=b}),ia=B.f,ja=ha("toStringTag"),ka=function(a,b,c){a&&!I(a=c?a:a.prototype,ja)&&ia(a,ja,{configurable:!0,value:b})},la={};D(la,ha("iterator"),function(){return this});var ma=function(a,b,c){a.prototype=ga(la,{next:C(1,c)}),ka(a,b+" Iterator")},na=function(a){return Object(k(a))},oa=X("IE_PROTO"),pa=Object.prototype,qa=Object.getPrototypeOf||function(a){return a=na(a),I(a,oa)?a[oa]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?pa:null},ra=ha("iterator"),sa=!([].keys&&"next"in[].keys()),ta=function(){return this},ua=function(a,b,c,d,e,f,h){ma(c,b,d);var i,j,k,l=function(a){if(!sa&&a in p)return p[a];switch(a){case"keys":case"values":return function(){return new c(this,a)}}return function(){return new c(this,a)}},m=b+" Iterator",n="values"==e,o=!1,p=a.prototype,q=p[ra]||p["@@iterator"]||e&&p[e],r=q||l(e),s=e?n?l("entries"):r:void 0,t="Array"==b?p.entries||q:q;if(t&&(k=qa(t.call(new a)))!==Object.prototype&&ka(k,m,!0),n&&q&&"values"!==q.name&&(o=!0,r=function(){return q.call(this)}),h&&(sa||o||!p[ra])&&D(p,ra,r),g[b]=r,g[m]=ta,e)if(i={values:n?r:l("values"),keys:f?r:l("keys"),entries:s},h)for(j in i)j in p||G(p,j,i[j]);else F(F.P+F.F*(sa||o),b,i);return i};ua(Array,"Array",function(a,b){this._t=l(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,f(1)):"keys"==b?f(0,c):"values"==b?f(0,a[c]):f(0,[c,a[c]])},"values");g.Arguments=g.Array;for(var va=ha("toStringTag"),wa=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],xa=0;xa<5;xa++){var ya=wa[xa],za=m[ya],Aa=za&&za.prototype;Aa&&!Aa[va]&&D(Aa,va,ya),g[ya]=g.Array}var Ba=function(a){return function(b,c){var d,e,f=String(k(b)),g=L(c),h=f.length;return g<0||g>=h?a?"":void 0:(d=f.charCodeAt(g),d<55296||d>56319||g+1===h||(e=f.charCodeAt(g+1))<56320||e>57343?a?f.charAt(g):d:a?f.slice(g,g+2):e-56320+(d-55296<<10)+65536)}}(!0);ua(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=Ba(b,c),this._i+=a.length,{value:a,done:!1})});var Ca,Da,Ea,Fa=ha("toStringTag"),Ga="Arguments"==i(function(){return arguments}()),Ha=function(a,b){try{return a[b]}catch(a){}},Ia=function(a){var b,c,d;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=Ha(b=Object(a),Fa))?c:Ga?i(b):"Object"==(d=i(b))&&"function"==typeof b.callee?"Arguments":d},Ja=ha("iterator"),Ka=n.isIterable=function(a){var b=Object(a);return void 0!==b[Ja]||"@@iterator"in b||g.hasOwnProperty(Ia(b))},La=Ka,Ma=d(function(a){a.exports={default:La,__esModule:!0}}),Na=ha("iterator"),Oa=n.getIteratorMethod=function(a){if(void 0!=a)return a[Na]||a["@@iterator"]||g[Ia(a)]},Pa=n.getIterator=function(a){var b=Oa(a);if("function"!=typeof b)throw TypeError(a+" is not iterable!");return r(b.call(a))},Qa=Pa,Ra=d(function(a){a.exports={default:Qa,__esModule:!0}}),Sa=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=c(Ma),e=c(Ra);b.default=function(){function a(a,b){var c=[],d=!0,f=!1,g=void 0;try{for(var h,i=(0,e.default)(a);!(d=(h=i.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(a){f=!0,g=a}finally{try{!d&&i.return&&i.return()}finally{if(f)throw g}}return c}return function(b,c){if(Array.isArray(b))return b;if((0,d.default)(Object(b)))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),Ta=c(Sa),Ua=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a},Va=function(a,b,c,d){try{return d?b(r(c)[0],c[1]):b(c)}catch(b){var e=a.return;throw void 0!==e&&r(e.call(a)),b}},Wa=ha("iterator"),Xa=Array.prototype,Ya=function(a){return void 0!==a&&(g.Array===a||Xa[Wa]===a)},Za=d(function(a){var b={},c={},d=a.exports=function(a,d,e,f,g){var h,i,j,k,l=g?function(){return a}:Oa(a),m=p(e,f,d?2:1),n=0;if("function"!=typeof l)throw TypeError(a+" is not iterable!");if(Ya(l)){for(h=N(a.length);h>n;n++)if((k=d?m(r(i=a[n])[0],i[1]):m(a[n]))===b||k===c)return k}else for(j=l.call(a);!(i=j.next()).done;)if((k=Va(j,m,i.value,d))===b||k===c)return k};d.BREAK=b,d.RETURN=c}),$a=ha("species"),_a=function(a,b){var c,d=r(a).constructor;return void 0===d||void 0==(c=r(d)[$a])?b:o(c)},ab=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)},bb=m.process,cb=m.setImmediate,db=m.clearImmediate,eb=m.MessageChannel,fb=0,gb={},hb=function(){var a=+this;if(gb.hasOwnProperty(a)){var b=gb[a];delete gb[a],b()}},ib=function(a){hb.call(a.data)};cb&&db||(cb=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return gb[++fb]=function(){ab("function"==typeof a?a:Function(a),b)},Ca(fb),fb},db=function(a){delete gb[a]},"process"==i(bb)?Ca=function(a){bb.nextTick(p(hb,a,1))}:eb?(Da=new eb,Ea=Da.port2,Da.port1.onmessage=ib,Ca=p(Ea.postMessage,Ea,1)):m.addEventListener&&"function"==typeof postMessage&&!m.importScripts?(Ca=function(a){m.postMessage(a+"","*")},m.addEventListener("message",ib,!1)):Ca="onreadystatechange"in w("script")?function(a){ca.appendChild(w("script")).onreadystatechange=function(){ca.removeChild(this),hb.call(a)}}:function(a){setTimeout(p(hb,a,1),0)});var jb={set:cb,clear:db},kb=jb.set,lb=m.MutationObserver||m.WebKitMutationObserver,mb=m.process,nb=m.Promise,ob="process"==i(mb),pb=ha("species"),qb=ha("iterator"),rb=!1;try{var sb=[7][qb]();sb.return=function(){rb=!0},Array.from(sb,function(){throw 2})}catch(a){}var tb,ub,vb,wb=jb.set,xb=function(){var a,b,c,d=function(){var d,e;for(ob&&(d=mb.domain)&&d.exit();a;){e=a.fn,a=a.next;try{e()}catch(d){throw a?c():b=void 0,d}}b=void 0,d&&d.enter()};if(ob)c=function(){mb.nextTick(d)};else if(lb){var e=!0,f=document.createTextNode("");new lb(d).observe(f,{characterData:!0}),c=function(){f.data=e=!e}}else if(nb&&nb.resolve){var g=nb.resolve();c=function(){g.then(d)}}else c=function(){kb.call(m,d)};return function(d){var e={fn:d,next:void 0};b&&(b.next=e),a||(a=e,c()),b=e}}(),yb=m.TypeError,zb=m.process,Ab=m.Promise,zb=m.process,Bb="process"==Ia(zb),Cb=function(){},Db=!!function(){try{var a=Ab.resolve(1),b=(a.constructor={})[ha("species")]=function(a){a(Cb,Cb)};return(Bb||"function"==typeof PromiseRejectionEvent)&&a.then(Cb)instanceof b}catch(a){}}(),Eb=function(a,b){return a===b||a===Ab&&b===vb},Fb=function(a){var b;return!(!q(a)||"function"!=typeof(b=a.then))&&b},Gb=function(a){return Eb(Ab,a)?new Hb(a):new ub(a)},Hb=ub=function(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw yb("Bad Promise constructor");b=a,c=d}),this.resolve=o(b),this.reject=o(c)},Ib=function(a){try{a()}catch(a){return{error:a}}},Jb=function(a,b){if(!a._n){a._n=!0;var c=a._c;xb(function(){for(var d=a._v,e=1==a._s,f=0;c.length>f;)!function(b){var c,f,g=e?b.ok:b.fail,h=b.resolve,i=b.reject,j=b.domain;try{g?(e||(2==a._h&&Mb(a),a._h=1),!0===g?c=d:(j&&j.enter(),c=g(d),j&&j.exit()),c===b.promise?i(yb("Promise-chain cycle")):(f=Fb(c))?f.call(c,h,i):h(c)):i(d)}catch(a){i(a)}}(c[f++]);a._c=[],a._n=!1,b&&!a._h&&Kb(a)})}},Kb=function(a){wb.call(m,function(){var b,c,d,e=a._v;if(Lb(a)&&(b=Ib(function(){Bb?zb.emit("unhandledRejection",e,a):(c=m.onunhandledrejection)?c({promise:a,reason:e}):(d=m.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=Bb||Lb(a)?2:1),a._a=void 0,b)throw b.error})},Lb=function(a){if(1==a._h)return!1;for(var b,c=a._a||a._c,d=0;c.length>d;)if(b=c[d++],b.fail||!Lb(b.promise))return!1;return!0},Mb=function(a){wb.call(m,function(){var b;Bb?zb.emit("rejectionHandled",a):(b=m.onrejectionhandled)&&b({promise:a,reason:a._v})})},Nb=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),Jb(b,!0))},Ob=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw yb("Promise can't be resolved itself");(b=Fb(a))?xb(function(){var d={_w:c,_d:!1};try{b.call(a,p(Ob,d,1),p(Nb,d,1))}catch(a){Nb.call(d,a)}}):(c._v=a,c._s=1,Jb(c,!1))}catch(a){Nb.call({_w:c,_d:!1},a)}}};Db||(Ab=function(a){Ua(this,Ab,"Promise","_h"),o(a),tb.call(this);try{a(p(Ob,this,1),p(Nb,this,1))}catch(a){Nb.call(this,a)}},tb=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},tb.prototype=function(a,b,c){for(var d in b)c&&a[d]?a[d]=b[d]:D(a,d,b[d]);return a}(Ab.prototype,{then:function(a,b){var c=Gb(_a(this,Ab));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=Bb?zb.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&Jb(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),Hb=function(){var a=new tb;this.promise=a,this.resolve=p(Ob,a,1),this.reject=p(Nb,a,1)}),F(F.G+F.W+F.F*!Db,{Promise:Ab}),ka(Ab,"Promise"),function(a){var b="function"==typeof n[a]?n[a]:m[a];t&&b&&!b[pb]&&B.f(b,pb,{configurable:!0,get:function(){return this}})}("Promise"),vb=n.Promise,F(F.S+F.F*!Db,"Promise",{reject:function(a){var b=Gb(this);return(0,b.reject)(a),b.promise}}),F(F.S+!0*F.F,"Promise",{resolve:function(a){if(a instanceof Ab&&Eb(a.constructor,this))return a;var b=Gb(this);return(0,b.resolve)(a),b.promise}}),F(F.S+F.F*!(Db&&function(a,b){if(!b&&!rb)return!1;var c=!1;try{var d=[7],e=d[qb]();e.next=function(){return{done:c=!0}},d[qb]=function(){return e},a(d)}catch(a){}return c}(function(a){Ab.all(a).catch(Cb)})),"Promise",{all:function(a){var b=this,c=Gb(b),d=c.resolve,e=c.reject,f=Ib(function(){var c=[],f=0,g=1;Za(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f&&e(f.error),c.promise},race:function(a){var b=this,c=Gb(b),d=c.reject,e=Ib(function(){Za(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e&&d(e.error),c.promise}});var Pb=n.Promise,Qb=d(function(a){a.exports={default:Pb,__esModule:!0}}),Rb=c(Qb),Sb=Object.getOwnPropertySymbols,Tb={f:Sb},Ub={}.propertyIsEnumerable,Vb={f:Ub},Wb=Object.assign,Xb=!Wb||s(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=Wb({},a)[c]||Object.keys(Wb({},b)).join("")!=d})?function(a,b){for(var c=na(a),d=arguments.length,e=1,f=Tb.f,g=Vb.f;d>e;)for(var h,i=j(arguments[e++]),k=f?aa(i).concat(f(i)):aa(i),l=k.length,m=0;l>m;)g.call(i,h=k[m++])&&(c[h]=i[h]);return c}:Wb;F(F.S+F.F,"Object",{assign:Xb});var Yb=n.Object.assign,Zb=d(function(a){a.exports={default:Yb,__esModule:!0}}),$b=c(Zb),_b=d(function(a,b){b.__esModule=!0,b.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}}),ac=c(_b),bc=ha,cc={f:bc},dc=cc.f("iterator"),ec=d(function(a){a.exports={default:dc,__esModule:!0}}),fc=d(function(a){var b=V("meta"),c=B.f,d=0,e=Object.isExtensible||function(){return!0},f=!s(function(){return e(Object.preventExtensions({}))}),g=function(a){c(a,b,{value:{i:"O"+ ++d,w:{}}})},h=function(a,c){if(!q(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!I(a,b)){if(!e(a))return"F";if(!c)return"E";g(a)}return a[b].i},i=function(a,c){if(!I(a,b)){if(!e(a))return!0;if(!c)return!1;g(a)}return a[b].w},j=function(a){return f&&k.NEED&&e(a)&&!I(a,b)&&g(a),a},k=a.exports={KEY:b,NEED:!1,fastKey:h,getWeak:i,onFreeze:j}}),gc=B.f,hc=function(a){var b=n.Symbol||(n.Symbol={});"_"==a.charAt(0)||a in b||gc(b,a,{value:cc.f(a)})},ic=function(a,b){for(var c,d=l(a),e=aa(d),f=e.length,g=0;f>g;)if(d[c=e[g++]]===b)return c},jc=function(a){var b=aa(a),c=Tb.f;if(c)for(var d,e=c(a),f=Vb.f,g=0;e.length>g;)f.call(a,d=e[g++])&&b.push(d);return b},kc=Array.isArray||function(a){return"Array"==i(a)},lc=_.concat("length","prototype"),mc=Object.getOwnPropertyNames||function(a){return $(a,lc)},nc={f:mc},oc=nc.f,pc={}.toString,qc="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],rc=function(a){try{return oc(a)}catch(a){return qc.slice()}},sc=function(a){return qc&&"[object Window]"==pc.call(a)?rc(a):oc(l(a))},tc={f:sc},uc=Object.getOwnPropertyDescriptor,vc=t?uc:function(a,b){if(a=l(a),b=y(b,!0),x)try{return uc(a,b)}catch(a){}if(I(a,b))return C(!Vb.f.call(a,b),a[b])},wc={f:vc},xc=fc.KEY,yc=wc.f,zc=B.f,Ac=tc.f,Bc=m.Symbol,Cc=m.JSON,Dc=Cc&&Cc.stringify,Ec=ha("_hidden"),Fc=ha("toPrimitive"),Gc={}.propertyIsEnumerable,Hc=S("symbol-registry"),Ic=S("symbols"),Jc=S("op-symbols"),Kc=Object.prototype,Lc="function"==typeof Bc,Mc=m.QObject,Nc=!Mc||!Mc.prototype||!Mc.prototype.findChild,Oc=t&&s(function(){return 7!=ga(zc({},"a",{get:function(){return zc(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=yc(Kc,b);d&&delete Kc[b],zc(a,b,c),d&&a!==Kc&&zc(Kc,b,d)}:zc,Pc=function(a){var b=Ic[a]=ga(Bc.prototype);return b._k=a,b},Qc=Lc&&"symbol"==typeof Bc.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof Bc},Rc=function(a,b,c){return a===Kc&&Rc(Jc,b,c),r(a),b=y(b,!0),r(c),I(Ic,b)?(c.enumerable?(I(a,Ec)&&a[Ec][b]&&(a[Ec][b]=!1),c=ga(c,{enumerable:C(0,!1)})):(I(a,Ec)||zc(a,Ec,C(1,{})),a[Ec][b]=!0),Oc(a,b,c)):zc(a,b,c)},Sc=function(a,b){r(a);for(var c,d=jc(b=l(b)),e=0,f=d.length;f>e;)Rc(a,c=d[e++],b[c]);return a},Tc=function(a,b){return void 0===b?ga(a):Sc(ga(a),b)},Uc=function(a){var b=Gc.call(this,a=y(a,!0));return!(this===Kc&&I(Ic,a)&&!I(Jc,a))&&(!(b||!I(this,a)||!I(Ic,a)||I(this,Ec)&&this[Ec][a])||b)},Vc=function(a,b){if(a=l(a),b=y(b,!0),a!==Kc||!I(Ic,b)||I(Jc,b)){var c=yc(a,b);return!c||!I(Ic,b)||I(a,Ec)&&a[Ec][b]||(c.enumerable=!0),c}},Wc=function(a){for(var b,c=Ac(l(a)),d=[],e=0;c.length>e;)I(Ic,b=c[e++])||b==Ec||b==xc||d.push(b);return d},Xc=function(a){for(var b,c=a===Kc,d=Ac(c?Jc:l(a)),e=[],f=0;d.length>f;)!I(Ic,b=d[f++])||c&&!I(Kc,b)||e.push(Ic[b]);return e};Lc||(Bc=function(){if(this instanceof Bc)throw TypeError("Symbol is not a constructor!");var a=V(arguments.length>0?arguments[0]:void 0),b=function(c){this===Kc&&b.call(Jc,c),I(this,Ec)&&I(this[Ec],a)&&(this[Ec][a]=!1),Oc(this,a,C(1,c))};return t&&Nc&&Oc(Kc,a,{configurable:!0,set:b}),Pc(a)},G(Bc.prototype,"toString",function(){return this._k}),wc.f=Vc,B.f=Rc,nc.f=tc.f=Wc,Vb.f=Uc,Tb.f=Xc,cc.f=function(a){return Pc(ha(a))}),F(F.G+F.W+F.F*!Lc,{Symbol:Bc});for(var Yc="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Zc=0;Yc.length>Zc;)ha(Yc[Zc++]);for(var Yc=aa(ha.store),Zc=0;Yc.length>Zc;)hc(Yc[Zc++]);F(F.S+F.F*!Lc,"Symbol",{for:function(a){return I(Hc,a+="")?Hc[a]:Hc[a]=Bc(a)},keyFor:function(a){if(Qc(a))return ic(Hc,a);throw TypeError(a+" is not a symbol!")},useSetter:function(){Nc=!0},useSimple:function(){Nc=!1}}),F(F.S+F.F*!Lc,"Object",{create:Tc,defineProperty:Rc,defineProperties:Sc,getOwnPropertyDescriptor:Vc,getOwnPropertyNames:Wc,getOwnPropertySymbols:Xc}),Cc&&F(F.S+F.F*(!Lc||s(function(){var a=Bc();return"[null]"!=Dc([a])||"{}"!=Dc({a:a})||"{}"!=Dc(Object(a))})),"JSON",{stringify:function(a){if(void 0!==a&&!Qc(a)){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);return b=d[1],"function"==typeof b&&(c=b),!c&&kc(b)||(b=function(a,b){if(c&&(b=c.call(this,a,b)),!Qc(b))return b}),d[1]=b,Dc.apply(Cc,d)}}}),Bc.prototype[Fc]||D(Bc.prototype,Fc,Bc.prototype.valueOf),ka(Bc,"Symbol"),ka(Math,"Math",!0),ka(m.JSON,"JSON",!0),hc("asyncIterator"),hc("observable");var $c=n.Symbol,_c=d(function(a){a.exports={default:$c,__esModule:!0}}),ad=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=c(ec),e=c(_c),f="function"==typeof e.default&&"symbol"==typeof d.default?function(a){return typeof a}:function(a){return a&&"function"==typeof e.default&&a.constructor===e.default&&a!==e.default.prototype?"symbol":typeof a};b.default="function"==typeof e.default&&"symbol"===f(d.default)?function(a){return void 0===a?"undefined":f(a)}:function(a){return a&&"function"==typeof e.default&&a.constructor===e.default&&a!==e.default.prototype?"symbol":void 0===a?"undefined":f(a)}}),bd=d(function(a,b){b.__esModule=!0;var c=function(a){return a&&a.__esModule?a:{default:a}}(ad);b.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":(0,c.default)(b))&&"function"!=typeof b?a:b}}),cd=c(bd),dd=function(a,b){if(r(a),!q(b)&&null!==b)throw TypeError(b+": can't set as prototype!")},ed={set:Object.setPrototypeOf||("__proto__"in{}?function(a,b,c){try{c=p(Function.call,wc.f(Object.prototype,"__proto__").set,2),c(a,[]),b=!(a instanceof Array)}catch(a){b=!0}return function(a,d){return dd(a,d),b?a.__proto__=d:c(a,d),a}}({},!1):void 0),check:dd};F(F.S,"Object",{setPrototypeOf:ed.set});var fd=n.Object.setPrototypeOf,gd=d(function(a){a.exports={default:fd,__esModule:!0}});F(F.S,"Object",{create:ga});var hd=n.Object,id=function(a,b){return hd.create(a,b)},jd=d(function(a){a.exports={default:id,__esModule:!0}}),kd=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}b.__esModule=!0;var d=c(gd),e=c(jd),f=c(ad);b.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":(0,f.default)(b)));a.prototype=(0,e.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(d.default?(0,d.default)(a,b):a.__proto__=b)}}),ld=c(kd),md=d(function(a){function b(){}function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){this._events=new b,this._eventsCount=0}var e=Object.prototype.hasOwnProperty,f="~";Object.create&&(b.prototype=Object.create(null),(new b).__proto__||(f=!1)),d.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)e.call(a,b)&&c.push(f?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},d.prototype.listeners=function(a,b){var c=f?f+a:a,d=this._events[c];if(b)return!!d;if(!d)return[];if(d.fn)return[d.fn];for(var e=0,g=d.length,h=new Array(g);e<g;e++)h[e]=d[e].fn;return h},d.prototype.emit=function(a,b,c,d,e,g){var h=f?f+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,g),!0}for(j=1,i=new Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=new Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0),g=f?f+a:a;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],e]:this._events[g].push(e):(this._events[g]=e,this._eventsCount++),this},d.prototype.removeListener=function(a,c,d,e){var g=f?f+a:a;if(!this._events[g])return this;if(!c)return 0==--this._eventsCount?this._events=new b:delete this._events[g],this;var h=this._events[g];if(h.fn)h.fn!==c||e&&!h.once||d&&h.context!==d||(0==--this._eventsCount?this._events=new b:delete this._events[g]);else{for(var i=0,j=[],k=h.length;i<k;i++)(h[i].fn!==c||e&&!h[i].once||d&&h[i].context!==d)&&j.push(h[i]);j.length?this._events[g]=1===j.length?j[0]:j:0==--this._eventsCount?this._events=new b:delete this._events[g]}return this},d.prototype.removeAllListeners=function(a){var c;return a?(c=f?f+a:a,this._events[c]&&(0==--this._eventsCount?this._events=new b:delete this._events[c])):(this._events=new b,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.prefixed=f,d.EventEmitter=d,a.exports=d});F(F.S+F.F*!t,"Object",{defineProperty:B.f});var nd=n.Object,od=function(a,b,c){return nd.defineProperty(a,b,c)},pd=d(function(a){a.exports={default:od,__esModule:!0}}),qd=d(function(a,b){b.__esModule=!0;var c=function(a){return a&&a.__esModule?a:{default:a}}(pd);b.default=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),(0,c.default)(a,e.key,e)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()}),rd=c(qd),sd=d(function(a,b){!function(){var c={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var d="string"==typeof a.initial?{state:a.initial}:a.initial,e=a.terminal||a.final,f=b||a.target||{},g=a.events||[],h=a.callbacks||{},i={},j={},k=function(a){var b=Array.isArray(a.from)?a.from:a.from?[a.from]:[c.WILDCARD];i[a.name]=i[a.name]||{};for(var d=0;d<b.length;d++)j[b[d]]=j[b[d]]||[],j[b[d]].push(a.name),i[a.name][b[d]]=a.to||b[d];a.to&&(j[a.to]=j[a.to]||[])};d&&(d.event=d.event||"startup",k({name:d.event,from:"none",to:d.state}));for(var l=0;l<g.length;l++)k(g[l]);for(var m in i)i.hasOwnProperty(m)&&(f[m]=c.buildEvent(m,i[m]));for(var m in h)h.hasOwnProperty(m)&&(f[m]=h[m]);return f.current="none",f.is=function(a){return Array.isArray(a)?a.indexOf(this.current)>=0:this.current===a},f.can=function(a){return!this.transition&&void 0!==i[a]&&(i[a].hasOwnProperty(this.current)||i[a].hasOwnProperty(c.WILDCARD))},f.cannot=function(a){return!this.can(a)},f.transitions=function(){return(j[this.current]||[]).concat(j[c.WILDCARD]||[])},f.isFinished=function(){return this.is(e)},f.error=a.error||function(a,b,c,d,e,f,g){throw g||f},f.states=function(){return Object.keys(j).sort()},d&&!d.defer&&f[d.event](),f},doCallback:function(a,b,d,e,f,g){if(b)try{return b.apply(a,[d,e,f].concat(g))}catch(b){return a.error(d,e,f,g,c.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",b)}},beforeAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onbeforeevent,b,d,e,f)},afterAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onafterevent||a.onevent,b,d,e,f)},leaveAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onleavestate,b,d,e,f)},enterAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onenterstate||a.onstate,b,d,e,f)},changeState:function(a,b,d,e,f){return c.doCallback(a,a.onchangestate,b,d,e,f)},beforeThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onbefore"+b],b,d,e,f)},afterThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onafter"+b]||a["on"+b],b,d,e,f)},leaveThisState:function(a,b,d,e,f){return c.doCallback(a,a["onleave"+d],b,d,e,f)},enterThisState:function(a,b,d,e,f){return c.doCallback(a,a["onenter"+e]||a["on"+e],b,d,e,f)},beforeEvent:function(a,b,d,e,f){if(!1===c.beforeThisEvent(a,b,d,e,f)||!1===c.beforeAnyEvent(a,b,d,e,f))return!1},afterEvent:function(a,b,d,e,f){c.afterThisEvent(a,b,d,e,f),c.afterAnyEvent(a,b,d,e,f)},leaveState:function(a,b,d,e,f){var g=c.leaveThisState(a,b,d,e,f),h=c.leaveAnyState(a,b,d,e,f);return!1!==g&&!1!==h&&(c.ASYNC===g||c.ASYNC===h?c.ASYNC:void 0)},enterState:function(a,b,d,e,f){c.enterThisState(a,b,d,e,f),c.enterAnyState(a,b,d,e,f)},buildEvent:function(a,b){return function(){var d=this.current,e=b[d]||(b[c.WILDCARD]!=c.WILDCARD?b[c.WILDCARD]:d)||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,d,e,f,c.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,d,e,f,c.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===c.beforeEvent(this,a,d,e,f))return c.Result.CANCELLED;if(d===e)return c.afterEvent(this,a,d,e,f),c.Result.NOTRANSITION;var g=this;this.transition=function(){return g.transition=null,g.current=e,c.enterState(g,a,d,e,f),c.changeState(g,a,d,e,f),c.afterEvent(g,a,d,e,f),c.Result.SUCCEEDED},this.transition.cancel=function(){g.transition=null,c.afterEvent(g,a,d,e,f)};var h=c.leaveState(this,a,d,e,f);return!1===h?(this.transition=null,c.Result.CANCELLED):c.ASYNC===h?c.Result.PENDING:this.transition?this.transition():void 0}}};a.exports&&(b=a.exports=c),b.StateMachine=c}()}),td=function(){return sd.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]})},ud=d(function(a,b){!function(b){function c(a){var b=k(a);if(q)for(var c,d=0;c=t[d++];)a.hasOwnProperty(c)&&b.push(c);return b}function d(a,b,d){for(var e,f,h=c(d),i=0,j=h.length;i<j;)"__self"!==(e=h[i++])&&(f=d[e],!o(f)||f.prototype&&f.prototype.__self||g&&!(f.toString().indexOf(".__base")>-1)?b[e]=f:b[e]=function(c,d){var e=a[c]?a[c]:"__constructor"===c?b.__self.__parent:p,f=function(){var a=this.__base;this.__base=f.__base;var b=d.apply(this,arguments);return this.__base=a,b};return f.__base=e,f}(e,f))}function e(a,b){for(var c,d=1;c=a[d++];)b?o(c)?f.self(b,c.prototype,c):f.self(b,c):b=o(c)?f(a[0],c.prototype,c):f(a[0],c);return b||a[0]}function f(){var a=arguments,b=n(a[0]),c=b||o(a[0]),f=c?b?e(a[0]):a[0]:h,g=a[c?1:0]||{},i=a[c?2:1],k=g.__constructor||c&&f.prototype&&f.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:c?function(){return f.apply(this,arguments)}:function(){};if(!c)return k.prototype=g,k.prototype.__self=k.prototype.constructor=k,l(k,i);l(k,f),k.__parent=f;var m=f.prototype,p=k.prototype=j(m);return p.__self=p.constructor=k,g&&d(m,p,g),i&&d(f,k,i),k}var g=function(){return"_"}.toString().indexOf("_")>-1,h=function(){},i=Object.prototype.hasOwnProperty,j=Object.create||function(a){var b=function(){};return b.prototype=a,new b},k=Object.keys||function(a){var b=[];for(var c in a)i.call(a,c)&&b.push(c);return b},l=function(a,b){for(var c in b)i.call(b,c)&&(a[c]=b[c]);return a},m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=function(a){return"[object Function]"===m.call(a)},p=function(){},q=!0,r={toString:""};for(var s in r)r.hasOwnProperty(s)&&(q=!1);var t=q?["toString","valueOf"]:null;f.self=function(){var a=arguments,b=n(a[0]),c=b?e(a[0],a[0][0]):a[0],f=a[1],g=a[2],h=c.prototype;return f&&d(h,h,f),g&&d(c,c,g),c};var u=!0;a.exports=f,u=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(a){a(f)}),u=!1),u&&(b.inherit=f)}(e)}),vd=ud;if(!b.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed")
;var wd=vd(b.TypedMessage,{__constructor:function(a){this.__base(),this.payload=a,this.setTransient(!0)}});b.messageField("payload")(wd);var xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd=(xd=b.messageType(-102))(yd=function(a){function b(){return ac(this,b),cd(this,a.apply(this,arguments))}return ld(b,a),b}(wd))||yd,Id=(zd=b.messageType(-103))(Ad=function(a){function b(){return ac(this,b),cd(this,a.apply(this,arguments))}return ld(b,a),b}(wd))||Ad,Jd=(Bd=b.messageType(-104))(Cd=function(a){function b(){return ac(this,b),cd(this,a.apply(this,arguments))}return ld(b,a),b}(wd))||Cd,Kd=(Dd=b.messageType(-105))(Ed=function(a){function b(){return ac(this,b),cd(this,a.apply(this,arguments))}return ld(b,a),b}(wd))||Ed,Ld=function(a){function b(c,d){ac(this,b);var e=cd(this,a.call(this));e._setConversation(c),e._peerConnection=e._createPeerConnection(d),e._call=td(),e._promises={};var f=new Rb(function(a){e._promises.resolveStreamReady=a}),g=new Rb(function(a){e._promises.resolveAccept=a});return Rb.all([f,g]).then(function(a){var b=Ta(a,1),c=b[0];e._call.can("connect")&&(e._call.connect(),e.emit("connect",c))}),e}return ld(b,a),b.prototype.close=function(){var a=this;return Rb.resolve().then(function(){a._call.close(),a._destroyPeerConnection(),a._peerConnection.close(),a._destroy()})},b.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},b.prototype._setConversation=function(a){this._conversation&&this._conversation.off("message"),a&&(this._conversation=a,a.on("message",this._handleMessage.bind(this)))},b.prototype._destroy=function(){this._conversation.off("message")},b.prototype._createPeerConnection=function(a){var b=new RTCPeerConnection(a);return b.onicecandidate=this._handleICECandidateEvent.bind(this),b.onaddstream=this._handleAddStreamEvent.bind(this),b.onnremovestream=this._handleRemoveStreamEvent.bind(this),b.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),b.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),b},b.prototype._destroyPeerConnection=function(){var a=this._peerConnection;delete a.onaddstream,delete a.onremovestream,delete a.onnicecandidate,delete a.oniceconnectionstatechange,delete a.onsignalingstatechange},b.prototype._handleMessage=function(a){return a instanceof Hd?this._handleAnswer(a):a instanceof Jd?this._handleRefusal():a instanceof Kd?this._handleCancelation():a instanceof Id&&this._handleICECandidate(a)},b.prototype._handleICECandidate=function(a){var b=new RTCIceCandidate(a.payload);this._peerConnection&&this._peerConnection.addIceCandidate(b).catch(console.error.bind(console))},b.prototype._handleICECandidateEvent=function(a){return!(!a.candidate||!this._conversation)&&this._conversation.send(new Id(a.candidate)).catch(console.error.bind(console))},b.prototype._handleAddStreamEvent=function(a){this._promises.resolveStreamReady(a.stream)},b.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},b.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},b.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},b.prototype._handleAnswer=function(){throw new Error("not implemented")},b.prototype._handleRefusal=function(){throw new Error("not implemented")},b.prototype._handleCancelation=function(){throw new Error("not implemented")},rd(b,[{key:"state",get:function(){return this._call.current}}]),b}(md),Md=function(a){function b(c,d,e){ac(this,b);var f=cd(this,a.call(this,d,e));return f.to=c,f}return ld(b,a),b.prototype._handleAnswer=function(a){var b=new RTCSessionDescription(a.payload);this._peerConnection.setRemoteDescription(b),this._promises.resolveAccept()},b.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},b.prototype.cancel=function(){var a=this;return this._call.cancel(),this._conversation.send(new Kd).then(function(){return a._destroy()})},b.prototype.close=function(){return this._call.can("cancel")?this.cancel():a.prototype.close.call(this)},b}(Ld),Nd=function(a){function b(c,d,e){ac(this,b);var f=cd(this,a.call(this,d,e));f.from=c.from;var g=new RTCSessionDescription(c.payload);return f._handleOfferPromise=f._peerConnection.setRemoteDescription(g),f}return ld(b,a),b.prototype.accept=function(a){var b=this;if(!a)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return b._peerConnection.addStream(a)}).then(function(){return b._peerConnection.createAnswer()}).then(function(a){return b._peerConnection.setLocalDescription(a)}).then(function(){return b._conversation.send(new Hd(b._peerConnection.localDescription))}).then(function(){return b._promises.resolveAccept()})},b.prototype.refuse=function(){var a=this;return this._conversation.send(new Jd).then(function(){a._call.refuse(),a._destroy()})},b.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},b}(Ld),Od=(Fd=b.messageType(-101))(Gd=function(a){function b(){return ac(this,b),cd(this,a.apply(this,arguments))}return ld(b,a),b}(wd))||Gd,Pd={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},Qd=function(a){function b(c,d){if(ac(this,b),"string"!=typeof c)throw new TypeError("id is not a string");var e=cd(this,a.call(this));return e.id=c,e.options=$b({RTCConfiguration:Pd},d),e}return ld(b,a),b.prototype._open=function(a,b){var c=this;return a.createIMClient(this.id,b,"webrtc").then(function(a){return c._imClient=a,c.id=a.id,a.on("message",function(a,b){return a instanceof Od&&c._handleOffer(a,b)}),a.on("conflict",function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c.emit.apply(c,["conflict"].concat(b))}),c})},b.prototype.close=function(){return this._imClient.close()},b.prototype.call=function(a,b){var c=this;if("string"!=typeof a)throw new TypeError("target id is not a string");if(!b)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([a]).then(function(d){if(!d.length)throw new Error("Call failed as "+a+" is not online");var e=new Md(a,null,c.options.RTCConfiguration),f=new Rb(function(a){e._peerConnection.onnegotiationneeded=a});return e._peerConnection.addStream(b),f.then(function(){return Rb.all([c._imClient.createConversation({members:[a],unique:!0}),e._peerConnection.createOffer().then(function(a){e._peerConnection.setLocalDescription(a)})])}).then(function(a){var b=Ta(a,1),c=b[0];return e._setConversation(c),c.send(new Od(e._peerConnection.localDescription))}).then(function(){return e})})},b.prototype._handleOffer=function(a,b){var c=new Nd(a,b,this.options.RTCConfiguration);this.emit("call",c)},b}(md),Rd=[Od,Hd,Id,Jd,Kd],Sd=function(a){a.createWebRTCClient=function(b,c){return new Qd(b)._open(a,c)}},Td={name:"leancloud-realtime-plugin-webrtc",messageClasses:Rd,onRealtimeCreate:Sd},Ud=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);a.WebRTCPlugin=Td,a.isWebRTCSupported=Ud,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map